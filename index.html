<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Work Orders List – Aberdeen Laundry Services (Engineering)</title>
  <style>
    :root{
      --ink:#0b0f1a;
      --muted:#6b7280;
      --als-blue:#0b67c2;
      --als-blue-strong:#0a5cb0;
      --thead:#0b67c2;
      --thead-text:#ffffff;
      --grid:#e6e9ef;
      --zebra:#ffffff;
      --chip-cat-tx:#0b67c2;
      --chip-cat-br:#0b67c2;
      --done-tx:#059669;
      --open-tx:#0b67c2;
      --hold-tx:#b45309;
      --done-bg:#0596691a;
      --open-bg:#0b67c21a;
      --hold-bg:#f59e0b1a;
      --paper:#ffffff;
    }

    @media (prefers-color-scheme: dark){
      :root{
        color-scheme: dark;
        --ink:#f3f4f6;
        --muted:#9ca3af;
        --als-blue:#3b82f6;
        --als-blue-strong:#2563eb;
        --thead:#1e3a8a;
        --thead-text:#ffffff;
        --grid:#374151;
        --zebra:#1f2937;
        --chip-cat-tx:#3b82f6;
        --chip-cat-br:#3b82f6;
        --done-tx:#10b981;
        --open-tx:#3b82f6;
        --hold-tx:#fbbf24;
        --done-bg:#10b98133;
        --open-bg:#3b82f633;
        --hold-bg:#f59e0b33;
        --paper:#111827;
      }
    }

    .dark{
      --ink:#f3f4f6;
      --muted:#9ca3af;
      --als-blue:#3b82f6;
      --als-blue-strong:#2563eb;
      --thead:#1e3a8a;
      --thead-text:#ffffff;
      --grid:#374151;
      --zebra:#1f2937;
      --chip-cat-tx:#3b82f6;
      --chip-cat-br:#3b82f6;
      --done-tx:#10b981;
      --open-tx:#3b82f6;
      --hold-tx:#fbbf24;
      --done-bg:#10b98133;
      --open-bg:#3b82f633;
      --hold-bg:#f59e0b33;
      --paper:#111827;
      color-scheme: dark;
    }

    .light{
      --ink:#0b0f1a;
      --muted:#6b7280;
      --als-blue:#0b67c2;
      --als-blue-strong:#0a5cb0;
      --thead:#0b67c2;
      --thead-text:#ffffff;
      --grid:#e6e9ef;
      --zebra:#ffffff;
      --chip-cat-tx:#0b67c2;
      --chip-cat-br:#0b67c2;
      --done-tx:#059669;
      --open-tx:#0b67c2;
      --hold-tx:#b45309;
      --done-bg:#0596691a;
      --open-bg:#0b67c21a;
      --hold-bg:#f59e0b1a;
      --paper:#ffffff;
      color-scheme: light;
    }

    html,body{height:100%}
    body{
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--ink); background:var(--paper); margin:0; font-size:13px; line-height:1.32;
      -webkit-print-color-adjust: exact; print-color-adjust: exact;
    }

    .page{
      --page-pad-top:40px;
      --page-pad-inline:48px;
      --page-pad-bottom:56px;
      padding:var(--page-pad-top) var(--page-pad-inline) var(--page-pad-bottom);
      box-sizing:border-box;
    }

    .page-head{ display:flex; align-items:flex-start; justify-content:space-between; }
    .title{ font-size:28px; font-weight:800; color:var(--ink); margin:0 0 8px; }
    .logo{ height:50px; }

    .top-rule{ height:6px; background:var(--als-blue); border-bottom:1px solid var(--als-blue-strong); margin:8px 0 10px; }

    table{ width:100%; border-collapse:separate; border-spacing:0; table-layout:fixed; }
    table th, table td{ overflow-wrap:anywhere; word-break:break-word; }
    thead th { position: sticky; top: 0; z-index: 3; }
    thead th{
      background:var(--thead); color:var(--thead-text); text-transform:uppercase; letter-spacing:.6px;
      font-weight:800; font-size:11px; padding:10px 8px; border-right:1px solid rgba(255,255,255,.08);
      cursor:pointer;
    }
    thead th .sort-arrow{ margin-left:4px; }
    thead th[data-sort="asc"] .sort-arrow::after{ content:'\25B2'; }
    thead th[data-sort="desc"] .sort-arrow::after{ content:'\25BC'; }
    thead th:first-child{ border-top-left-radius:3px; }
    thead th:last-child{ border-top-right-radius:3px; border-right:none; }

    tbody td{ background:var(--zebra); border-bottom:1px solid var(--grid); padding:10px 8px; vertical-align:top; }

    .col-id{ width:66px; }
    .col-title{ width:240px; }
    .col-status{ width:120px; }
    .col-priority{ width:92px; }
    .col-createdby{ width:140px; }
    .col-createdon{ width:110px; }
    .col-completedon{ width:110px; }
    .col-updated{ width:120px; }
    .col-location{ width:180px; }
    .col-asset{ width:200px; }
    .col-categories{ width:200px; }

    .id{ font-weight:700; }
    .title-cell b{ display:block; font-weight:800; }

    .chip-cat{ display:inline-block; color:var(--chip-cat-tx); border:1.8px solid var(--chip-cat-br); padding:2px 8px; border-radius:6px; background:var(--paper); margin:2px 6px 2px 0; font-weight:700; }

    .status-chip{ display:inline-flex; align-items:center; padding:2px 8px; border-radius:6px; font-weight:700; }
    .status-chip::before{ margin-right:4px; }
    .status-chip.done{ color:var(--done-tx); background:var(--done-bg); }
    .status-chip.done::before{ content:'\2713'; }
    .status-chip.open{ color:var(--open-tx); background:var(--open-bg); }
    .status-chip.open::before{ content:'\26AA'; }
    .status-chip.in-progress{ color:var(--open-tx); background:var(--open-bg); }
    .status-chip.in-progress::before{ content:'\23F3'; }
    .status-chip.on-hold{ color:var(--hold-tx); background:var(--hold-bg); }
    .status-chip.on-hold::before{ content:'\23F8'; }

    .ico{ width:16px; height:16px; vertical-align:-3px; margin-right:6px; }
    .done{ color:var(--done-tx); font-weight:800; }
    .open{ color:var(--open-tx); font-weight:800; }

    footer{ margin-top:8px; color:var(--muted); font-size:11px; display:flex; justify-content:space-between; }

    .controls{ display:flex; gap:12px; align-items:center; margin:8px 0 12px; font-size:12px; flex-wrap:wrap; }
    .controls input[type="file"], .controls textarea{ font:inherit; }
    .controls textarea{ width:min(100%, 520px); height:100px; padding:8px; border:1px solid var(--grid); border-radius:6px; }
    .btn{ padding:6px 10px; border:1px solid var(--als-blue); border-radius:8px; background:var(--paper); color:var(--als-blue); font-weight:700; cursor:pointer; }

    @media (max-width: 960px){
      .page{
        --page-pad-top:32px;
        --page-pad-inline:32px;
        --page-pad-bottom:44px;
      }
    }

    @media (max-width: 680px){
      .page{
        --page-pad-top:24px;
        --page-pad-inline:18px;
        --page-pad-bottom:32px;
      }
      .page-head{ flex-direction:column; align-items:flex-start; gap:12px; }
      .title{ font-size:24px; margin-bottom:4px; }
      .logo{ height:42px; }
      .controls{ gap:10px; }
      .controls textarea{ width:100%; min-width:0; }
    }

    @media print{
      @page{ size: A4 landscape; margin: 10mm; }
      body{ font-size:11.5px; }
      thead{ display:table-header-group; }
      table{ width:100% !important; table-layout:fixed; border-collapse:collapse; }
      th, td{ box-sizing:border-box; overflow-wrap:anywhere; word-break:break-word; hyphens:auto; }
      thead th { position: static; }
      .title-cell, .col-categories{ break-inside:avoid; }
      html{-webkit-print-color-adjust:exact;}
      .controls{ display:none !important; }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="page-head">
      <h1 class="title">Work Orders List</h1>
      <img class="logo" alt="Aberdeen Laundry Services" src="LOGOlesswhitespace.png">
    </div>
    <div class="top-rule"></div>

    <div class="controls" aria-hidden="false">
      <label class="btn" for="file">Upload CSV/TSV/JSON</label>
      <input id="file" type="file" accept=".csv,.tsv,.json,application/json,text/csv,text/tab-separated-values" style="display:none" />
      <button class="btn" id="pasteBtn" type="button">Paste data → render</button>
      <button class="btn" id="themeBtn" type="button">Dark mode</button>
      <textarea id="pasteBox" placeholder="Paste CSV (headers required) or JSON array here..."></textarea>
    </div>

    <table role="table" aria-label="Work Orders" id="workTable">
      <thead id="thead"></thead>
      <tbody id="tbody"></tbody>
    </table>

    <footer>
      <span></span>
      <span></span>
    </footer>
  </div>

  <script>
    let currentHeaders = [];
    let currentRows = [];
    let sortState = {};

    const categoryColors = {
      'mechanical': {
        light: { background: '#f59e0b1a', border: '#f59e0b', color: '#92400e' },
        dark: { background: '#f59e0b33', border: '#f59e0b', color: '#fbbf24' }
      },
      'inspection': {
        light: { background: '#3b82f61a', border: '#3b82f6', color: '#1e40af' },
        dark: { background: '#3b82f633', border: '#3b82f6', color: '#93c5fd' }
      },
      'electrical': {
        light: { background: '#10b9811a', border: '#10b981', color: '#065f46' },
        dark: { background: '#10b98133', border: '#10b981', color: '#6ee7b7' }
      },
      'resin': {
        light: { background: '#a855f71a', border: '#a855f7', color: '#6b21a8' },
        dark: { background: '#a855f733', border: '#a855f7', color: '#d8b4fe' }
      },
      'weekly-procedures': {
        light: { background: '#ef44441a', border: '#ef4444', color: '#991b1b' },
        dark: { background: '#ef444433', border: '#ef4444', color: '#fca5a5' }
      }
    };

    const styleEl = document.createElement('style');
    styleEl.textContent = Object.entries(categoryColors).map(([slug, colors]) => `
      .chip-cat.cat-${slug}{background:${colors.light.background};color:${colors.light.color};border-color:${colors.light.border};}
      .dark .chip-cat.cat-${slug}{background:${colors.dark.background};color:${colors.dark.color};border-color:${colors.dark.border};}
    `).join('');
    document.head.appendChild(styleEl);

    const elThead = document.getElementById('thead');
    const elTbody = document.getElementById('tbody');

    function esc(s){ return String(s==null?'':s).replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

    function slugify(str){
      return str.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,'');
    }

    function renderHeader(headers){
      currentHeaders = headers;
      elThead.innerHTML = `<tr>${headers.map(h=>`<th data-col="${esc(h)}" tabindex="0"><span>${esc(h)}</span><span class="sort-arrow"></span></th>`).join('')}</tr>`;
      elThead.querySelectorAll('th').forEach(th=>{
        th.addEventListener('click', ()=>sortByColumn(th.getAttribute('data-col'), th));
        th.addEventListener('keydown', e=>{
          if(e.key==='Enter' || e.key===' '){
            e.preventDefault();
            sortByColumn(th.getAttribute('data-col'), th);
          }
        });
      });
    }

    function renderRows(rows){
      currentRows = rows;
      elTbody.innerHTML = rows.map(row => {
        return `<tr>${currentHeaders.map(h=>{
          const v = row[h];
          if(h === 'Categories'){
            const cats = String(v||'').split(';').map(c=>c.trim()).filter(Boolean);
            const chips = cats.map(cat=>{
              const slug = slugify(cat);
              return `<span class="chip-cat cat-${slug}">${esc(cat)}</span>`;
            }).join('');
            return `<td>${chips}</td>`;
          }
          if(h === 'Status'){
            const slug = slugify(String(v||''));
            return `<td><span class="status-chip ${slug}">${esc(v)}</span></td>`;
          }
          return `<td>${esc(v)}</td>`;
        }).join('')}</tr>`;
      }).join('\n');
    }

    function renderTable(headers, rows){
      renderHeader(headers);
      renderRows(rows);
    }

    function sortByColumn(col, th){
      const direction = sortState[col] === 'asc' ? 'desc' : 'asc';
      sortState = { [col]: direction };
      document.querySelectorAll('thead th').forEach(h=>{
        if(h!==th){
          h.removeAttribute('data-sort');
          h.setAttribute('aria-sort','none');
        }
      });
      th.setAttribute('data-sort', direction);
      th.setAttribute('aria-sort', direction==='asc'?'ascending':'descending');
      const sorted = [...currentRows].sort((a,b)=>{
        const va = a[col] ?? '';
        const vb = b[col] ?? '';
        const nva = parseFloat(va);
        const nvb = parseFloat(vb);
        if(!isNaN(nva) && !isNaN(nvb)){
          return direction==='asc'?nva-nvb:nvb-nva;
        }
        return direction==='asc'
          ? String(va).localeCompare(String(vb))
          : String(vb).localeCompare(String(va));
      });
      renderRows(sorted);
    }

    function parseDelimited(text){
      const sep = text.includes('\t') ? '\t' : ',';
      const rows = text.trim().split(/\r?\n/).map(r=>r.split(new RegExp(`${sep}(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)`)).map(c=>c.replace(/^\"|\"$/g,'')));
      const headers = rows.shift() || [];
      const data = rows.map(r=>Object.fromEntries(r.map((v,i)=>[headers[i]||`col${i}`, v])));
      return {headers, rows:data};
    }

    function handleJSON(text){
      const data = JSON.parse(text);
      let rows = [];
      if(Array.isArray(data)) rows = data;
      else if(Array.isArray(data.rows)) rows = data.rows;
      const headers = rows.length ? Object.keys(rows[0]) : [];
      return {headers, rows};
    }

    document.getElementById('file').addEventListener('change', e=>{
      const f = e.target.files[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        const text = reader.result;
        let headers = [];
        let rows = [];
        try{
          const result = (/json$/i.test(f.name) || text.trim().startsWith('[') || text.trim().startsWith('{'))
            ? handleJSON(text)
            : parseDelimited(text);
          headers = result.headers;
          rows = result.rows;
        }catch(err){
          alert('Could not parse file: '+err.message);
        }
        renderTable(headers, rows);
      };
      reader.readAsText(f);
    });

    document.getElementById('pasteBtn').addEventListener('click', ()=>{
      const text = document.getElementById('pasteBox').value;
      if(!text.trim()) return;
      let headers = [];
      let rows=[];
      try{
        const result = (text.trim().startsWith('[') || text.trim().startsWith('{')) ? handleJSON(text) : parseDelimited(text);
        headers = result.headers;
        rows = result.rows;
      }catch(err){ alert('Parse error: '+err.message); }
      renderTable(headers, rows);
    });

      const themeBtn = document.getElementById('themeBtn');

      function applyTheme(theme){
        const isDark = theme === 'dark';
        document.body.classList.toggle('dark', isDark);
        document.body.classList.toggle('light', !isDark);
        themeBtn.textContent = isDark ? 'Light mode' : 'Dark mode';
      }

      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = savedTheme || (prefersDark ? 'dark' : 'light');
      applyTheme(theme);

      themeBtn.addEventListener('click', ()=>{
        const newTheme = document.body.classList.contains('dark') ? 'light' : 'dark';
        applyTheme(newTheme);
        localStorage.setItem('theme', newTheme);
      });

    const demo = [
      {
        ID:'#8683', Title:'Ironer 1 – Grease and Check Oil Gearboxes', Status:'Done', Priority:'Medium',
        'Created by':'Roger Hunter', 'Created on':'11/09/2025 09:05', 'Completed on':'12/09/2025 14:22', 'Last updated':'12/09/2025 14:26',
        Location:'Cathkin (East Kilbride)', Asset:'Ironer 1 Baker Perkins - EK', Categories:'Inspection; Mechanical; Weekly Procedures'
      },
      {
        ID:'#8731', Title:'Ironer 2 – Grease and Check Oil Gearboxes', Status:'Open', Priority:'Medium',
        'Created by':'Roger Hunter', 'Created on':'12/09/2025 09:10', 'Completed on':'', 'Last updated':'13/09/2025 08:01',
        Location:'Cathkin (East Kilbride)', Asset:'Ironer 2 Baker Perkins - EK', Categories:'Inspection; Mechanical'
      }
    ];

    renderTable(Object.keys(demo[0]||{}), demo);
  </script>
</body>
</html>
